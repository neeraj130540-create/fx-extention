<fx-settings-panel [fxData]="fxData" [tableData]="fxData" (configuration)="onChangeConfiguration($event)">
  <div *ngIf="fxData">
    <table style="width: 100%;" class="formBuilder_dynamic_table">
      <thead>
        <tr>
          <th *ngFor="let column of tableConfig.columns">{{ column.header }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let row of tableConfig.rows; let rowIndex = index">
          <td *ngFor="let column of tableConfig.columns">
            <ng-container [ngSwitch]="column.cellType">
              <span [class]="column?.className" *ngSwitchCase="'text'">{{row[column.header]}}</span>

              <!-- <input [class]="column?.className" *ngSwitchCase="'input-text'" type="text" [placeholder]="column?.placeholder"
                                [(ngModel)]="row[column.header]" /> -->

              <ng-container *ngSwitchCase="'input-text'">
                <input [class]="column?.className" type="text" [placeholder]="column?.placeholder"
                  [(ngModel)]="row[column.header]" [required]="column?.isRequired" #model="ngModel" />

                <div *ngIf="column?.isRequired && model.invalid && model.touched" class="text-red-500 text-sm mt-1">
                  {{ column?.errorMessage }}
                </div>
              </ng-container>



              <input [class]="column?.className" *ngSwitchCase="'input-number'" type="number"
                [placeholder]="column?.placeholder" [(ngModel)]="row[column.header]" />

              <select [class]="column?.className" *ngSwitchCase="'dropdown'" [(ngModel)]="row[column.header]">

                <option *ngIf="column.placeholder" value="">{{ column.placeholder }}</option>
                <option *ngFor="let option of column?.options" [value]="option?.optionValue">
                  {{ option?.optionName }}
                </option>
              </select>

              <!-- <select [class]="column?.className" style="width: 60%;" *ngSwitchCase="'smart-dropdown'"
                                [(ngModel)]="row[column.header]">
                                <option value="">Select {{column.header}}</option>
                                <option *ngIf="column.placeholder" value="">{{ column.placeholder }}</option>
                                <option *ngFor="let option of smartDropdownOptions[column.header]" [value]="option?.value">
                                    {{option?.name }}
                                </option>
                            </select> -->

              <!-- <p-multiSelect [options]="smartDropdownOptions[column.header]" [(ngModel)]="row[column.header]" optionLabel="name" optionValue="value" placeholder="Select Cities" *ngSwitchCase="'smart-dropdown'"/> -->

              <!-- smart-dropdown handling -->
              <ng-container *ngSwitchCase="'smart-dropdown'">

                <!-- Regular dropdown if isMultiselect is false or not set -->
                <select *ngIf="!column?.isMultiselect" [class]="column?.className" style="width: 60%;"
                  [(ngModel)]="row[column.header]">
                  <option *ngIf="column.placeholder" value="">{{ column.placeholder }}</option>
                  <option *ngFor="let option of smartDropdownOptions[column.header]" [value]="option?.value">
                    {{ option?.name }}
                  </option>
                  <option value="__other__">Other</option>

                </select>
                <input *ngIf="row[column.header] === '__other__'" type="text" class="mt-2 p-inputtext-sm"
                  [placeholder]="'Enter other ' + column.header" [(ngModel)]="row[column.header + '_other']" />

                <!-- PrimeNG multiselect if isMultiselect is true -->
                <p-multiSelect *ngIf="column?.isMultiselect" [options]="smartDropdownOptions[column.header]"
                  [(ngModel)]="row[column.header]" [class]="column?.className" optionLabel="name" optionValue="value"
                  [placeholder]="column.placeholder || ('Select ' + column.header)">
                  <ng-template pTemplate="dropdownicon">
                    <div class="flex align-items-center dd_down_icon">
                      <span class="pi pi-angle-down text-xl"></span>
                    </div>
                  </ng-template>
                </p-multiSelect>

              </ng-container>


              <!-- <input [class]="column?.className" *ngSwitchCase="'checkbox'" type="checkbox"
                                [(ngModel)]="row[column.header]" /> -->
              <ng-container *ngSwitchCase="'checkbox'">
                <label [class]="column?.className" class="inline-flex items-center gap-2">
                  <input type="checkbox" [checked]="row[column.header] === column.checkedValue"
                    (change)="onCheckboxChange($event, row, column)" />
                  {{ column?.checkBoxLabel || '' }}
                </label>
              </ng-container>
              <p-toast></p-toast>
              <p-confirmDialog></p-confirmDialog>
              <ng-container *ngSwitchCase="'action'">
                <div class="flex flex-row gap-6 justify-start items-start">
                  <div *ngFor="let action of column?.action" class="flex flex-col items-center w-20 cursor-pointer"
                    (click)="handleAction(row, action,rowIndex)">
                    <img [src]="action?.actionIconPath" alt="icon" class="w-6 h-6 mb-1" />
                    <span class="text-xs text-center break-words">
                      {{ action?.actionName }}
                    </span>
                  </div>
                </div>
              </ng-container>






              <input name="radio-{{rowIndex}}" [class]="column?.className" *ngSwitchCase="'radio'" type="radio"
                [(ngModel)]="row[column.header]" />

              <div [class]="column?.className" style="display: flex; justify-content: center; gap: 10px;"
                *ngSwitchCase="'radio-group'">
                <label *ngFor="let option of column.options">
                  <input name="radio-group-{{rowIndex}}" type="radio" [value]="option?.optionName"
                    [(ngModel)]="row[column.header]" />
                  {{ option?.optionName }}
                </label>
              </div>

              <!-- <ng-container *ngSwitchCase="'file-upload'">
                               

                                  <div class="flex flex-col items-end justify-end relative">
                                    <div class="flex gap-2 flex-wrap">
                                      <div 
                                        class="relative" 
                                        *ngFor="let image of uploadedImages?.[rowIndex]; let i = index"
                                      >
                                        <img  
                                          width="100" 
                                          [src]="image?.result"
                                          alt="Uploaded Image"
                                          class="rounded shadow"
                                        />
                                        <button 
                                          (click)="deleteFile(rowIndex, i)" 
                                          class="absolute top-0 right-0 text-white rounded-md w-5 h-5 flex items-center justify-center shadow-lg hover:bg-red-600"
                                        >
                                          ‚ùå
                                        </button>
                                      </div>
                                    </div>
                                  
                                    <input 
                                      [class]="column?.className" 
                                      type="file" 
                                      name="file" 
                                      #uploadFile  
                                      hidden 
                                      multiple
                                      (change)="uploadImage($event, rowIndex)" 
                                    />
                                  
                                    <button 
                                      (click)="uploadFile.click()" 
                                      class="mt-2 bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600"
                                    >
                                      Upload
                                    </button>
                                  </div>
                                  
                                  
                            </ng-container> -->

              <ng-container *ngSwitchCase="'file-upload'">
                <div class="flex items-center justify-end relative gap-4 flex-wrap">
                  <div class="flex gap-2 flex-wrap">
                    <div class="relative" *ngFor="let image of uploadedImages?.[rowIndex]; let i = index">
                      <img width="100" height="80" [src]="image?.result" alt="Uploaded Image"
                        class="rounded shadow orientation" />
                      <a (click)="deleteFile(rowIndex, i)"
                        class="absolute top-0 right-0 text-white rounded-md w-5 h-5 flex items-center justify-center cursor-pointer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                          <g clip-path="url(#clip0_6837_29683)">
                            <rect width="18" height="18" rx="9" fill="#F3A041" />
                            <mask id="mask0_6837_29683" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="4" y="4"
                              width="24" height="24">
                              <rect x="4" y="4" width="24" height="24" fill="#D9D9D9" />
                            </mask>
                            <g mask="url(#mask0_6837_29683)">
                              <path
                                d="M8.2045 8.99815L5.81802 6.61167L6.61351 5.81617L9 8.20266L11.3865 5.81617L12.182 6.61167L9.7955 8.99815L12.182 11.3846L11.3865 12.1801L9 9.79365L6.61351 12.1801L5.81802 11.3846L8.2045 8.99815Z"
                                fill="white" />
                            </g>
                          </g>
                          <defs>
                            <clipPath id="clip0_6837_29683">
                              <rect width="18" height="18" rx="9" fill="white" />
                            </clipPath>
                          </defs>
                        </svg>
                      </a>
                    </div>
                  </div>

                  <input [class]="column?.className" type="file" name="file" #uploadFile hidden multiple
                    (change)="uploadImage($event, rowIndex)" />
                  <div class="flex flex-col justify-center items-center cursor-pointer" (click)="uploadFile.click()">
                    <div>
                      <svg xmlns="http://www.w3.org/2000/svg" width="29" height="28" viewBox="0 0 29 28" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                          d="M14.001 3.00195C11.5322 3.00195 9.16722 3.86956 7.23641 5.38414L7.23598 4.59695C7.23598 4.52473 7.22175 4.45321 7.19411 4.38648C7.16647 4.31975 7.12596 4.25912 7.07489 4.20804C7.02381 4.15697 6.96318 4.11646 6.89645 4.08882C6.82972 4.06118 6.7582 4.04695 6.68598 4.04695C6.61375 4.04695 6.54223 4.06118 6.4755 4.08882C6.40877 4.11646 6.34814 4.15697 6.29707 4.20804C6.24599 4.25912 6.20548 4.31975 6.17784 4.38648C6.1502 4.45321 6.13598 4.52473 6.13598 4.59695L6.13642 6.68652C6.13643 6.83239 6.19438 6.97228 6.29752 7.07542C6.40067 7.17856 6.54055 7.23651 6.68642 7.23652H8.77598C8.8482 7.23652 8.91972 7.2223 8.98645 7.19466C9.05318 7.16702 9.11381 7.12651 9.16489 7.07543C9.21596 7.02436 9.25647 6.96373 9.28411 6.897C9.31175 6.83027 9.32598 6.75875 9.32598 6.68652C9.32598 6.6143 9.31175 6.54278 9.28411 6.47605C9.25647 6.40932 9.21596 6.34869 9.16489 6.29761C9.11381 6.24654 9.05318 6.20603 8.98645 6.17839C8.91972 6.15075 8.8482 6.13652 8.77598 6.13652H8.0584C9.7702 4.84387 11.8399 4.10195 14.001 4.10195C19.4751 4.10195 23.901 8.52782 23.901 14.002C23.901 19.4761 19.4751 23.902 14.001 23.902C8.52684 23.902 4.10098 19.4761 4.10098 14.002C4.10098 12.6381 4.38263 11.2888 4.92855 10.0389C4.98691 9.90532 4.98982 9.75399 4.93665 9.61822C4.88347 9.48246 4.77855 9.37336 4.64496 9.31492C4.57877 9.28596 4.50753 9.27032 4.4353 9.2689C4.36306 9.26747 4.29126 9.2803 4.22398 9.30663C4.15671 9.33297 4.09528 9.3723 4.04321 9.42238C3.99114 9.47247 3.94944 9.53232 3.92051 9.59852C3.31393 10.9872 3.00098 12.4866 3.00098 14.002C3.00098 20.0706 7.93236 25.002 14.001 25.002C20.0696 25.002 25.001 20.0706 25.001 14.002C25.001 7.93334 20.0696 3.00195 14.001 3.00195Z"
                          fill="#F3A041" />
                        <path fill-rule="evenodd" clip-rule="evenodd"
                          d="M13.9988 6.13965C9.6616 6.13965 6.13379 9.66746 6.13379 14.0046C6.13379 18.3418 9.6616 21.8696 13.9988 21.8696C18.336 21.8696 21.8638 18.3418 21.8638 14.0046C21.8638 9.66746 18.336 6.13965 13.9988 6.13965ZM13.9988 8.22965C14.1447 8.22965 14.2846 8.28759 14.3877 8.39074C14.4908 8.49388 14.5488 8.63378 14.5488 8.77965V13.7769L17.5227 16.7508C17.6258 16.8539 17.6837 16.9938 17.6837 17.1396C17.6837 17.2855 17.6258 17.4254 17.5227 17.5285C17.4195 17.6316 17.2796 17.6896 17.1338 17.6896C16.9879 17.6896 16.8481 17.6316 16.7449 17.5285L13.6099 14.3935C13.5068 14.2904 13.4488 14.1505 13.4488 14.0046V8.77965C13.4488 8.63378 13.5067 8.49388 13.6099 8.39074C13.713 8.28759 13.8529 8.22965 13.9988 8.22965Z"
                          fill="#F3A041" />
                        <rect width="28.56" height="28" rx="1.51479" fill="#F3A041" />
                        <path
                          d="M15.068 22.7391V17.6708H18.4968L14.2108 12.6025L9.9248 17.6708H13.3536V22.7391H9.06759V22.6969C8.92358 22.7053 8.78643 22.7391 8.63899 22.7391C6.93391 22.7391 5.29866 22.0717 4.09298 20.8835C2.8873 19.6954 2.20996 18.084 2.20996 16.4037C2.20996 13.1532 4.70443 10.5042 7.90523 10.141C8.18585 8.6953 8.96892 7.39118 10.1197 6.45292C11.2706 5.51465 12.7172 5.00089 14.2108 5C15.7047 5.00082 17.1515 5.51452 18.3026 6.45277C19.4537 7.39101 20.2371 8.69516 20.5181 10.141C23.7189 10.5042 26.21 13.1532 26.21 16.4037C26.21 18.084 25.5326 19.6954 24.3269 20.8835C23.1213 22.0717 21.486 22.7391 19.7809 22.7391C19.6369 22.7391 19.4981 22.7053 19.3523 22.6969V22.7391H15.068Z"
                          fill="white" />
                      </svg>
                    </div>
                    <a type="button" (click)="uploadFile.click()" class="text-base cursor-pointer">
                      {{ 'Upload' }}
                    </a>
                  </div>
                </div>
              </ng-container>
              <ng-container *ngSwitchCase="'textarea'">
                <textarea [class]="column?.className" name="" id="" cols="30" rows="2"
                  [placeholder]="column?.placeholder"></textarea>
              </ng-container>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
    <!-- Your main template -->
<p-dialog header="Confirmation"
[(visible)]="displayConfirmationDialog"
modal="true"
[closable]="false"
[responsive]="true"
styleClass="confirmation-dialog"
[style]="{width: '400px'}">

<div class="p-d-flex p-ai-center">
<i class="pi pi-exclamation-triangle p-mr-2" style="font-size: 2rem; color: #f39c12"></i>
<span>Are you sure you want to perform "<strong>{{ selectedAction?.actionName }}</strong>"?</span>
</div>

<ng-template pTemplate="footer">
<button pButton label="Yes" icon="pi pi-check" (click)="confirmAction()" class="p-button-text" autofocus></button>
<button pButton label="No" icon="pi pi-times" (click)="cancelAction()" class="p-button-text"></button>
</ng-template>
</p-dialog>

  </div>
</fx-settings-panel>