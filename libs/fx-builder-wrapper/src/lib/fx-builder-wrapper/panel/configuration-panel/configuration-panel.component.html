<p-dialog header="Edit Configurations" [modal]="true" [draggable]="false" [(visible)]="visible"
  [style]="{width: '70rem'}" class="customDialogClass" (onHide)="closeDialog()">
  <!-- <ng-template pTemplate="header">
    <div class="flex p-2 bg-white border-2">
        <p class="text-base">Edit Configurations</p>
    </div>
  </ng-template> -->
  <div class="flex flex-col gap-4 bg-white p-2 border-2 border-gray-200">
    <div class="flex items-center gap-4 mb-8 w-full">
      <div class="w-1/3">
        <label for="rows" class="font-semibold w-24">Rows</label>
        <input type="text" [disabled]="enableAPI" [(ngModel)]="rows" placeholder="rows" class="form__input" id="name"
          autocomplete="rows" />
      </div>
      <div class="w-1/3">
        <label for="enableAPI" class="font-semibold w-24">Enable API</label>
        <input type="checkbox" [(ngModel)]="enableAPI" placeholder="API Url" id="enableAPI" autocomplete="enableAPI" />
      </div>
      <div class="w-1/3">
        @if (enableAPI) {
        <ng-container>
          <label for="api" class="font-semibold w-24">API</label>
          <input type="text" [(ngModel)]="api" placeholder="Enter API Url" id="api" class="form__input"
            autocomplete="api" />
        </ng-container>
        }
      </div>

    </div>
    <!-- <div class="flex items-center gap-4 mb-8">
                  <div class="w-1/2">
                    
                  </div>
                  <div class="w-1/2">
                    
                    
                  </div>
                    
                   
                </div>
                
                  <div class="flex items-center gap-4 mb-8">
                    <div class="w-1/2">
                      
                    </div>
                    <div class="w-1/2">
                      
                    </div>
                      
                      
                  </div> -->

    <div class="flex flex-wrap gap-4 mb-8">

      <div class="w-full flex items-center justify-between">
        <p class="text-sm font-semibold">Columns:</p>
        <!-- <button type="button" (click)="addColumn()" class="custom-save-button">Add Column</button> -->
      </div>

      <div class="w-full overflow-x-auto">
        <form [formGroup]="dynamicForm" (ngSubmit)="onSubmit()">
          <!-- Flex container with nowrap to keep all columns in a single row -->
          <div formArrayName="columns" class="flex gap-4 flex-nowrap whitespace-nowrap">
            <div *ngFor="let column of columns.controls; let i = index" [formGroupName]="i"
              class="border p-4 rounded-lg min-w-[20rem] flex-shrink-0 card-width">
              <div class="top-2 right-2 flex gap-2 justify-end">
                <button type="button" (click)="duplicateColumn(i)"
                  class="bg-green-500 text-white px-3 py-1 rounded-md hover:bg-green-600">
                  ➕
                </button>
                <button type="button" (click)="removeColumn(i)" class="text-white px-3 py-1 rounded-md hover:bg-red-600"
                  *ngIf="columns.length>1">
                  ❌
                </button>
              </div>
              <!-- Columns in a Single Row -->
              <div class="grid grid-cols-1 gap-4 items-center mb-2">
                <div class="col-span-3">
                  <label class="font-semibold">Column Name:</label>
                  <input formControlName="header" placeholder="Enter Column Name"
                    class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                </div>
                <div class="col-span-3">
                  <label class="font-semibold">Column Type:</label>
                  <select formControlName="cellType" class="w-full border rounded-md px-3 py-2">
                    <option *ngFor="let type of columnTypes" [value]="type">{{ type }}</option>
                  </select>
                </div>
                <div class="col-span-3" *ngIf="['smart-dropdown', 'dropdown'].includes(column.value.cellType)">
                  <label class="font-semibold"> <input type="checkbox" formControlName="isMultiselect"
                      class="custom-margin" />Multiselect</label>
                  <!-- <select formControlName="isMultiselect" class="w-full border rounded-md px-3 py-2">
                                          <option  value="true">Enable</option>
                                          <option  value="false">Disable</option>
                                      </select> -->
                </div>
                <div class="col-span-3">
                  <label class="font-semibold">PlaceHolder:</label>
                  <input formControlName="placeholder" placeholder="Enter Placeholder"
                    class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                </div>
                <ng-container *ngIf="['checkbox'].includes(column.value.cellType)">
                  <div class="col-span-3">
                    <label class="font-semibold">CheckedValue:</label>
                    <input formControlName="checkedValue" placeholder="Enter checkedvalue"
                      class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                  </div>
                  <div class="col-span-3">
                    <label class="font-semibold">UnCheckedValue:</label>
                    <input formControlName="unCheckedValue" placeholder="Enter UnCheckedValue"
                      class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                  </div>
                  <div class="col-span-3">
                    <label class="font-semibold">Checkbox Label:</label>
                    <input formControlName="checkBoxLabel" placeholder="Enter Checkbox Label"
                      class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                  </div>
                </ng-container>
                <ng-container *ngIf="['input-text','input-number'].includes(column.value.cellType)">
                  <div class="col-span-3">
                    <label for="isRequired" class="font-semibold w-24">
                      <input type="checkbox" formControlName="isRequired" class="custom-margin" />Required</label>
                  </div>

                  <div class="col-span-3">
                    <label class="font-semibold">Error Message:</label>
                    <input formControlName="errorMessage" placeholder="Enter Checkbox Label"
                      class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                  </div>
                </ng-container>


                @if (enableAPI) {
                <div class="col-span-3">
                  <label class="font-semibold">API Value Key:</label>
                  <input formControlName="apiKey" placeholder="Enter Value Key"
                    class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                </div>
                }

              </div>
              <div *ngIf="['radio-group', 'dropdown'].includes(column.value.cellType)" class="mt-2">

                <label class="font-semibold">Options:</label>
                <button type="button" (click)="addOption(i)" class="custom-save-button justify-end"> ✚ </button>

                <div formArrayName="options" class="card-height">
                  <div *ngFor="let option of getOptions(i).controls; let j = index" [formGroupName]="j"
                    class="relative grid grid-cols-1 gap-4 items-center mt-2 option-card">

                    <button type="button" (click)="getOptions(i).removeAt(j)" class="absolute top-0 right-0 bg-transparent text-red-500 hover:text-red-700 
                                                    text-xl font-bold p-1 cursor-pointer">
                      ❌
                    </button>

                    <input formControlName="optionName" placeholder="Enter Option Name"
                      class="col-span-4 border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                    <input formControlName="optionValue" placeholder="Enter Option Value"
                      class="col-span-4 border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                  </div>

                </div>
                <!-- <button type="button" (click)="addOption(i)" class="custom-save-button justify-end">Add Option</button> -->
              </div>


              <div *ngIf="['smart-dropdown'].includes(column.value.cellType)" class="grid grid-cols-1 gap-4 mt-4">
                <div class="col-span-4">
                  <label class="font-semibold">API Url:</label>
                  <input formControlName="apiUrl" placeholder="Enter API URL"
                    class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                </div>
                <div class="col-span-4">
                  <label class="font-semibold">Value Key:</label>
                  <input formControlName="valueKey" placeholder="Enter Value Key"
                    class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                </div>
                <div class="col-span-4">
                  <label class="font-semibold">Label Key:</label>
                  <input formControlName="labelKey" placeholder="Enter Label Key"
                    class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                </div>
              </div>

              <!-- <div *ngIf="['action'].includes(column.value.cellType)" class="grid grid-cols-1 gap-4 mt-4">
                                  <div class="col-span-4">
                                      <label class="font-semibold">Action Name:</label>
                                      <input formControlName="actionName" placeholder="Enter Action Name" 
                                             class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                                  </div>
                                  <div class="col-span-4">
                                      <label class="font-semibold">Action Icon Path:</label>
                                      <input formControlName="actionIconPath" placeholder="Enter Icon Path" 
                                             class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                                  </div>
                                  <div class="col-span-4">
                                      <label class="font-semibold">API Type:</label>
                                      <select formControlName="apiType" class="w-full border rounded-md px-3 py-2">
                                          <option  value="GET">GET</option>
                                          <option  value="PUT">PUT</option>
                                          <option  value="POST">POST</option>
                                          <option  value="DELETE">DELETE</option>
                                      </select>
                                  </div>
                                  <div class="col-span-4">
                                    <label class="font-semibold">API URL:</label>
                                    <input formControlName="apiUrlToCall" placeholder="Enter API URL" 
                                    class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                                </div>
                                <div class="col-span-4">
                                  <label class="font-semibold">API Payload:</label>
                                  <button type="button" (click)="addPayloadOption(i)" class="custom-save-button justify-end"> ✚ </button>

                                  <div formArrayName="payloadOptions" class="card-height">
                                    <div *ngFor="let option of getPayloadOptions(i).controls; let j = index" [formGroupName]="j" 
                                    class="relative grid grid-cols-1 gap-4 items-center mt-2 option-card">
                                
                                   <button type="button" (click)="getPayloadOptions(i).removeAt(j)" 
                                           class="absolute top-0 right-0 bg-transparent text-red-500 hover:text-red-700 
                                                  text-xl font-bold p-1 cursor-pointer">
                                                  ❌
                                   </button>
                               
                                   <input formControlName="payloadOptionName" placeholder="Enter Option Name" 
                                          class="col-span-4 border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                                   <input formControlName="payloadOptionName" placeholder="Enter Option Value" 
                                          class="col-span-4 border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                              </div>
                                  </div>
                              </div>
                
                            </div> -->


              <!-- Only show if cellType is 'action' -->
              <div *ngIf="column.value.cellType === 'action'" class="grid grid-cols-1 gap-4 mt-4">

                <!-- Add Action Button -->
                <div class="flex justify-end mb-2">
                  <button type="button" (click)="addActionToColumn(i)"
                    class="bg-orange-400 text-white px-3 py-1 rounded-md hover:bg-blue-600">
                    ➕ Add Action
                  </button>
                </div>

                <!-- Loop through actions -->
                <div formArrayName="action">
                  <div *ngFor="let actionCtrl of getActions(i).controls; let j = index" [formGroupName]="j"
                    class="border p-4 rounded-md mb-4 bg-gray-50 relative">

                    <!-- Remove action button -->
                    <button type="button" (click)="removeActionFromColumn(i, j)"
                      class="absolute top-0 right-0 text-red-600 text-xl font-bold hover:text-red-800">❌</button>

                    <div class="mb-2">
                      <label class="font-semibold">Action Name:</label>
                      <input formControlName="actionName" placeholder="Enter Action Name"
                        class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                    </div>

                    <div class="mb-2">
                      <label class="font-semibold">Action Icon Path:</label>
                      <input formControlName="actionIconPath" placeholder="Enter Icon Path"
                        class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                    </div>

                    <div class="mb-2">
                      <label class="font-semibold">API Type:</label>
                      <select formControlName="apiType" class="w-full border rounded-md px-3 py-2">
                        <option value="GET">GET</option>
                        <option value="PUT">PUT</option>
                        <option value="POST">POST</option>
                        <option value="DELETE">DELETE</option>
                      </select>
                    </div>

                    <div class="mb-2">
                      <label class="font-semibold">API URL:</label>
                      <input formControlName="apiUrlToCall" placeholder="Enter API URL"
                        class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                    </div>

                    <!-- Payload Options -->
                    <div class="mb-2">
                      <div class="flex justify-between items-center">
                        <label class="font-semibold">API Payload:</label>
                        <button type="button" (click)="addPayloadOption(i, j)"
                          class="ml-2 text-green-600 font-bold text-xl">✚</button>
                      </div>
                      <div formArrayName="payloadOptions" class="mt-2" class="payload_action">
                        <div *ngFor="let payload of getPayloadOptions(i, j).controls; let k = index" [formGroupName]="k"
                          class="relative grid grid-cols-1 gap-2 items-center mb-2 border-1 border p-2  border-gray-500">

                          <button type="button" (click)="getPayloadOptions(i, j).removeAt(k)"
                            class="text-red-500 hover:text-red-700 text-xl font-bold flex justify-end items-center">❌</button>

                          <input formControlName="payloadOptionName" placeholder="Option Name"
                            class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                          <input formControlName="payloadOptionValue" placeholder="Option Value"
                            class="w-full border rounded-md px-3 py-2 focus:ring focus:ring-blue-200" />
                        </div>
                      </div>
                    </div>

                    <div class="mb-2">
                      <label for="isConfirmationRequired" class="font-semibold w-24">
                        <input type="checkbox" formControlName="isConfirmationRequired" class="custom-margin" /> Confirmation Required</label>
                    </div>

                  </div>
                </div>
              </div>

            </div>
          </div>
        </form>
      </div>




    </div>

  </div>



  <ng-template pTemplate="footer">
    <!-- <hr class="mt-3 mx-2 mb-0 opacity-10"> -->
    <!-- <div class="flex justify-end  gap-4 w-full">
                <p-button label="Cancel" severity="secondary" (click)="closeDialog()" />
                <p-button styleClass="border border-indigo-600" label="Save" (click)="saveConfiguration()" />
            </div> -->
    <div class="flex justify-center my-3">
      <p-button label="Cancel" severity="secondary" (click)="closeDialog()" styleClass="border-gray-400" />
      <p-button label="Attach" label="Save" (click)="saveConfiguration()"
        styleClass="cta_buttons text-medium button_text_white secondary-color border-1 stroke_secondary no_hightlight no_hightlight_stroke h-max mr-2 w-6rem custom-save-button" />
    </div>
  </ng-template>
</p-dialog>